<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="manypkgs">
<title>Agreements • manypkgs</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Agreements">
<meta property="og:description" content="manypkgs">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">manypkgs</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/contributor.html">Develop</a>
    <a class="dropdown-item" href="../articles/agreements.html">Agreements</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-other-packages">Other packages</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-other-packages">
    <a class="external-link dropdown-item" href="https://globalgov.github.io/manydata/">manydata</a>
    <a class="dropdown-item" href="https://globalgov.github.io/manypkgs/">manypkgs</a>
    <a class="external-link dropdown-item" href="https://globalgov.github.io/manyenviron/">manyenviron</a>
    <a class="external-link dropdown-item" href="https://globalgov.github.io/manytrade/">manytrade</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/globalgov/manystates">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="agreements_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Agreements</h1>
            
            <h4 data-toc-skip class="date">2022-02-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/globalgov/manypkgs/blob/HEAD/vignettes/agreements.Rmd" class="external-link"><code>vignettes/agreements.Rmd</code></a></small>
      <div class="d-none name"><code>agreements.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="outlining-the-problem">Outlining the problem<a class="anchor" aria-label="anchor" href="#outlining-the-problem"></a>
</h2>
<p>One of the central problems in ensembled data packages is setting equivalences between observations from different datasets. This is a central problem because it is what enables us to <em>relate</em> datasets to one another.</p>
<p>What is required is some classificatory scheme so that same is recognised as same and different observations are recognised as different. In many cases, it is useful to have some kind of registry of unique units that existing and, importantly, new data can be read against.</p>
<p>There are several important features of such a registry that, while not <em>required</em> are certainly very helpful:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Authoritative</strong>: the registry should be a singular source</li>
<li>
<strong>Comprehensivity</strong>: the registry should ideally cover all possible units</li>
<li>
<strong>Succinct</strong>: the registry codes should be as short as possible</li>
<li>
<strong>Intelligible</strong>: the registry codes should be as meaningful for humans as possible</li>
</ol>
<p>For some databases, unique identifiers are not too much of a problem because there exists a relatively comprehensive, authoritative, succinct, and intelligible registry. An example of this is the central <code>states</code> database in the <a href="https://github.com/globalgov/manystates" class="external-link">manystates</a> package. Here we can rely on ISO-3166 alpha-3 codes for most modern states, complementing them with COW or other codes for more historical states. This combined registry is made available through the <code><a href="https://rdrr.io/pkg/manystates/man/code_states.html" class="external-link">manystates::code_states()</a></code> function.</p>
<p>But we are not aware of comprehensive, authoritative, succinct, and intelligible registry of treaties. To solve this problem, we need to think both about how observations might be coded and what this codes might represent.</p>
</div>
<div class="section level2">
<h2 id="setting-up-the-problem">Setting up the problem<a class="anchor" aria-label="anchor" href="#setting-up-the-problem"></a>
</h2>
<p>To test different solutions to the problem, we construct a sample of treaty titles from three different datasets in the <code><a href="https://rdrr.io/pkg/manyenviron/man/agreements.html" class="external-link">manyenviron::agreements</a></code> database. Let’s take only titles of treaties established in a particular decade, the 1980s, so that we can increase the probability of matches.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">manyenviron</span><span class="op">)</span>
<span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu">manyenviron</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/manyenviron/man/agreements.html" class="external-link">agreements</a></span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="va">x</span><span class="op">$</span><span class="va">Beg</span> <span class="op">&gt;</span> <span class="st">"1990-01-01"</span> <span class="op">&amp;</span> <span class="va">x</span><span class="op">$</span><span class="va">Beg</span> <span class="op">&lt;</span> <span class="st">"2000-01-01"</span>, <span class="op">]</span><span class="op">)</span>
<span class="va">titles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">samples</span>, <span class="st">"Title"</span><span class="op">)</span><span class="op">)</span>
<span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">samples</span>, <span class="st">"Beg"</span><span class="op">)</span><span class="op">)</span>
<span class="va">sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind.data.frame</a></span><span class="op">(</span><span class="va">titles</span>, <span class="va">dates</span><span class="op">)</span></code></pre></div>
<p>The sample has been hand coded so that the exact number of agreements that are duplicates or linked to one another is known. We hand coded 400 agreements from the sample to compare duplicates identification.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/globalgov/manypkgs" class="external-link">manypkgs</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span>
<span class="va">agreements</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="st">"hand-coded-sample.csv"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="options-for-solutions">Options for solutions<a class="anchor" aria-label="anchor" href="#options-for-solutions"></a>
</h2>
<div class="section level3">
<h3 id="a-perfect-match">A perfect match<a class="anchor" aria-label="anchor" href="#a-perfect-match"></a>
</h3>
<p>If we use the hand coded duplicates to correctly identify all duplicates in the sample, we get a perfect match! That is, we identify all true positives and no false positives. The rates of true positives and false positives are represented the receiver operating characteristics (ROC) graph below. The area under the curve (AUC score), in dark grey, in the graph is maximized (equals 1).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/WinVector/WVPlots" class="external-link">WVPlots</a></span><span class="op">)</span>
<span class="fu">WVPlots</span><span class="fu">::</span><span class="fu"><a href="https://winvector.github.io/WVPlots//reference/ROCPlot.html" class="external-link">ROCPlot</a></span><span class="op">(</span><span class="va">agreements</span>, <span class="st">"duplicate"</span>, <span class="st">"duplicate"</span>, <span class="fl">1</span>, title <span class="op">=</span> <span class="st">"Duplicates Match"</span><span class="op">)</span></code></pre></div>
<p><img src="agreements_files/figure-html/hand-code-1.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># WVPlots::PRPlot(agreements, "duplicate", "duplicate", 1, title = "Duplicates Match")</span>
<span class="co"># Precision recall (PR) plots are also available for comparing solutions.</span></code></pre></div>
<p>In reality, we often do not get a perfect score as we rarely know all the true duplicates across several large datasets.</p>
</div>
<div class="section level3">
<h3 id="everything-unique">Everything unique<a class="anchor" aria-label="anchor" href="#everything-unique"></a>
</h3>
<p>First we could simply offer a unique code for each title, no duplicates. Obviously this would generate errors on the side of false negatives for many titles that are quite obviously (for humans) equivalent. That is, we would find zero false positives as well as zero true positives, as the ROC plot illustrates.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">agreements</span><span class="op">$</span><span class="va">unique</span> <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="fu">WVPlots</span><span class="fu">::</span><span class="fu"><a href="https://winvector.github.io/WVPlots//reference/ROCPlot.html" class="external-link">ROCPlot</a></span><span class="op">(</span><span class="va">agreements</span>, <span class="st">"unique"</span>, <span class="st">"duplicate"</span>, <span class="fl">1</span>, title <span class="op">=</span> <span class="st">"Unique"</span><span class="op">)</span></code></pre></div>
<p><img src="agreements_files/figure-html/unique-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># WVPlots::PRPlot(agreements, "unique", "duplicate", 1, title = "Unique")</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="random">Random<a class="anchor" aria-label="anchor" href="#random"></a>
</h3>
<p>If we randomly create a variable with 200 values and use it to find duplicates, the AUC scores marginally. The ROC plot illustrates how some true positives as well as a few false positives are matched.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">agreements</span><span class="op">$</span><span class="va">random</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">400</span><span class="op">)</span>
<span class="fu">WVPlots</span><span class="fu">::</span><span class="fu"><a href="https://winvector.github.io/WVPlots//reference/ROCPlot.html" class="external-link">ROCPlot</a></span><span class="op">(</span><span class="va">agreements</span>, <span class="st">"random"</span>, <span class="st">"duplicate"</span>, <span class="fl">1</span>, title <span class="op">=</span> <span class="st">"Random"</span><span class="op">)</span></code></pre></div>
<p><img src="agreements_files/figure-html/random-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># WVPlots::PRPlot(agreements, "random", "duplicate", 1, title = "Random")</span>
<span class="co"># PR results also illustrate well how Unique duplicate matches work.</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="strict-match">Strict match<a class="anchor" aria-label="anchor" href="#strict-match"></a>
</h3>
<p>Here we only consider equivalent those titles that are exactly the same as one another.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">agreements</span><span class="op">$</span><span class="va">strict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">agreements</span><span class="op">$</span><span class="va">titles</span><span class="op">)</span> <span class="op">|</span> 
                                  <span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">agreements</span><span class="op">$</span><span class="va">titles</span>, fromLast <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>
<span class="fu">WVPlots</span><span class="fu">::</span><span class="fu"><a href="https://winvector.github.io/WVPlots//reference/ROCPlot.html" class="external-link">ROCPlot</a></span><span class="op">(</span><span class="va">agreements</span>, <span class="st">"strict"</span>, <span class="st">"duplicate"</span>, <span class="fl">1</span>, title <span class="op">=</span> <span class="st">"Strict"</span><span class="op">)</span></code></pre></div>
<p><img src="agreements_files/figure-html/strict-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># WVPlots::PRPlot(agreements, "strict", "duplicate", 1, title = "Strict")</span>
<span class="co"># PR plot is consistent with ROC plot and shows little improvement from a random match.</span></code></pre></div>
<p>Note that the AUC probably boosted by our use of <code><a href="../reference/standardise_titles.html">manypkgs::standardise_titles()</a></code>, but misses a number of more problematic cases. For example a “Treaty Of…” and “Treaty For…” would be considered distinct, as would “Antarctic Treaty” and “Antarctic Treaty 1959”, even though they ought to be rendered equivalent. Strict match is very specify, but not very sensible, as it generates no false positives but it only captures a so many of the true positives.</p>
</div>
<div class="section level3">
<h3 id="fuzzy-match">Fuzzy match<a class="anchor" aria-label="anchor" href="#fuzzy-match"></a>
</h3>
<p>Fuzzy matching relies on <code>stringdist</code> to match observations that are mostly similar but not identical.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/markvanderloo/stringdist" class="external-link">stringdist</a></span><span class="op">)</span>
<span class="va">fuzzy</span> <span class="op">&lt;-</span> <span class="fu">stringdist</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringdist/man/stringsim.html" class="external-link">stringsimmatrix</a></span><span class="op">(</span><span class="va">agreements</span><span class="op">$</span><span class="va">titles</span>, <span class="va">agreements</span><span class="op">$</span><span class="va">titles</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">fuzzy</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="va">agreements</span><span class="op">$</span><span class="va">fuzzy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">fuzzy</span>, <span class="fl">1</span>, <span class="va">max</span><span class="op">)</span>
<span class="va">agreements</span><span class="op">$</span><span class="va">fuzzy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">agreements</span><span class="op">$</span><span class="va">fuzzy</span> <span class="op">&gt;</span> <span class="fl">0.8</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>
<span class="fu">WVPlots</span><span class="fu">::</span><span class="fu"><a href="https://winvector.github.io/WVPlots//reference/ROCPlot.html" class="external-link">ROCPlot</a></span><span class="op">(</span><span class="va">agreements</span>, <span class="st">"fuzzy"</span>, <span class="st">"duplicate"</span>, <span class="fl">1</span>, title <span class="op">=</span> <span class="st">"Fuzzy"</span><span class="op">)</span></code></pre></div>
<p><img src="agreements_files/figure-html/fuzzy-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># WVPlots::PRPlot(agreements, "fuzzy", "duplicate", 1, title = "Fuzzy")</span>
<span class="co"># Improvements are also visible in the PR plot. </span></code></pre></div>
<p>The risk of finding incorrect matches with fuzzy matching. This explains the slightly lower AUC score we get here in comparison to strict matches. That is, although we do a better job at finding true matches with fuzzy, we also get a few false positives. Moreover, this option is computationally expensive/takes a long time</p>
</div>
<div class="section level3">
<h3 id="identifying-information-extraction">Identifying information extraction<a class="anchor" aria-label="anchor" href="#identifying-information-extraction"></a>
</h3>
<p>Another option is to extract key identifying information from the titles and dates, rendering as equivalent any titles that have the same key identifying information.</p>
<p>The question here is which information to extract from the titles. It needs to be enough information to render as distinct those titles that are indeed distinct, but that ignores both less salient information (e.g. “Of” versus “For”) and addenda (e.g. the year at the end of the treaty title).</p>
<p>The less information we require for a match, the higher the false positive rate, and the more information we require, the higher the false negative rate.</p>
<p>Using our current version of <a href="https://github.com/globalgov/manypkgs" class="external-link">manypkgs</a> we obtain:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">agreements</span><span class="op">$</span><span class="va">treatyID</span> <span class="op">&lt;-</span> <span class="fu">manypkgs</span><span class="fu">::</span><span class="fu"><a href="../reference/code_agreements.html">code_agreements</a></span><span class="op">(</span><span class="va">agreements</span>, <span class="va">agreements</span><span class="op">$</span><span class="va">titles</span>, <span class="va">agreements</span><span class="op">$</span><span class="va">dates</span><span class="op">)</span>
<span class="co">#&gt; 0 entries were not matched at all.</span>
<span class="co">#&gt; There were 127 duplicated IDs.</span>
<span class="va">agreements</span><span class="op">$</span><span class="va">idinfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">agreements</span><span class="op">$</span><span class="va">treatyID</span><span class="op">)</span> <span class="op">|</span> 
                                  <span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">agreements</span><span class="op">$</span><span class="va">treatyID</span>, fromLast <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>
<span class="fu">WVPlots</span><span class="fu">::</span><span class="fu"><a href="https://winvector.github.io/WVPlots//reference/ROCPlot.html" class="external-link">ROCPlot</a></span><span class="op">(</span><span class="va">agreements</span>, <span class="st">"idinfo"</span>, <span class="st">"duplicate"</span>, <span class="fl">1</span>, title <span class="op">=</span> <span class="st">"treatyID Strict"</span><span class="op">)</span></code></pre></div>
<p><img src="agreements_files/figure-html/treatyID-1.png" width="700"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># WVPlots::PRPlot(agreements, "idinfo", "duplicate", 1, title = "treatyID Strict")</span>
<span class="co"># PR plot illustrate similarities betwwen a perfect match and treatyID match.</span></code></pre></div>
<p>The AUC score with <code><a href="../reference/code_agreements.html">code_agreements()</a></code> is higher than what we get with fuzzy and with strict matches. In relations to other options, <code><a href="../reference/code_agreements.html">code_agreements()</a></code> improves the number of true observations matched while not generating many false positives. Still, this is not perfect and some true matches are still missing. This happens when the titles differ a great deal, even if they are refering to the same agreement. In those cases, we prefer to stay on the side of caution and refrain from trying to code these titles as duplicates, especially as such changes would likely lead to higher rates of false positives.</p>
</div>
<div class="section level3">
<h3 id="condensing-treatyid-matches">Condensing treatyID matches<a class="anchor" aria-label="anchor" href="#condensing-treatyid-matches"></a>
</h3>
<p>We can also improve the AUC scores by fuzzy matching the new treatyIDs generated by <code><a href="../reference/code_agreements.html">code_agreements()</a></code> from different datasets with the <code><a href="../reference/condense_agreements.html">condense_agreements()</a></code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">qsim</span> <span class="op">&lt;-</span> <span class="fu">manypkgs</span><span class="fu">::</span><span class="fu"><a href="../reference/condense_agreements.html">condense_agreements</a></span><span class="op">(</span>var <span class="op">=</span> <span class="va">agreements</span><span class="op">$</span><span class="va">treatyID</span><span class="op">)</span>
<span class="va">agreements</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">agreements</span>, <span class="va">qsim</span>, by <span class="op">=</span> <span class="st">"treatyID"</span><span class="op">)</span>
<span class="va">agreements</span><span class="op">$</span><span class="va">qsim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">agreements</span><span class="op">$</span><span class="va">manyID</span><span class="op">)</span> <span class="op">|</span>
                            <span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">agreements</span><span class="op">$</span><span class="va">manyID</span>, fromLast <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>

<span class="fu">WVPlots</span><span class="fu">::</span><span class="fu"><a href="https://winvector.github.io/WVPlots//reference/ROCPlot.html" class="external-link">ROCPlot</a></span><span class="op">(</span><span class="va">agreements</span>, <span class="st">"qsim"</span>, <span class="st">"duplicate"</span>, <span class="fl">1</span>, title <span class="op">=</span> <span class="st">"treatyID Sim"</span><span class="op">)</span></code></pre></div>
<p><img src="agreements_files/figure-html/qsim-1.png" width="700"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># qsim &lt;- stringdist::stringsimmatrix(agreements$treatyID, agreements$treatyID)</span>
<span class="co"># diag(qsim) &lt;- 0</span>
<span class="co"># agreements$qsim &lt;- apply(qsim, 1, max)</span>
<span class="co"># WVPlots::ROCPlot(agreements, "qsim", "duplicate", 1, title = "treatyID Sim")</span>
<span class="co"># WVPlots::PRPlot(agreements, "qsim", "duplicate", 1, title = "treatyID Sim")</span>
<span class="co"># Better than above!</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="comparing-specificity-versus-sensitivity">Comparing specificity versus sensitivity<a class="anchor" aria-label="anchor" href="#comparing-specificity-versus-sensitivity"></a>
</h3>
<p>We can compare the specificity versus sensitivity for each of the possible solutions discussed above in the same ROC plot.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">WVPlots</span><span class="fu">::</span><span class="fu"><a href="https://winvector.github.io/WVPlots//reference/ROCPlotList.html" class="external-link">ROCPlotList</a></span><span class="op">(</span>frame <span class="op">=</span> <span class="va">agreements</span>, xvar_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"strict"</span>, <span class="st">"fuzzy"</span>, <span class="st">"idinfo"</span>, <span class="st">"qsim"</span><span class="op">)</span>, 
                     truthVar <span class="op">=</span> <span class="st">"duplicate"</span>, truthTarget <span class="op">=</span> <span class="cn">TRUE</span>, title <span class="op">=</span> <span class="st">"Comparing the different solutions"</span><span class="op">)</span></code></pre></div>
<p><img src="agreements_files/figure-html/comparison-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="how-to-read-a-treatyid">How to read a treatyID<a class="anchor" aria-label="anchor" href="#how-to-read-a-treatyid"></a>
</h2>
<p>A treatyID is a meaningful shorthand ID created from a combination of elements extracted from the agreement title and date. The treatyID allows users to identify date, type and linkage.</p>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th><strong>Type</strong></th>
<th><strong>Pasting</strong></th>
<th><strong>Pasting</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Bilateral</td>
<td>FRA-TON[DEZ]_1980A</td>
<td>parties[activity]_uID(type)</td>
</tr>
<tr class="even">
<td>Bilateral + Protocol</td>
<td>RUS-USA[FKC]_1967E:FKC_1965A</td>
<td>parties[activity]_uID(type)[action]:linkage</td>
</tr>
</tbody>
</table>
<p>A bilateral treaty that is an agreement will have the following treatyID: "FRA-TON[DEZ]_1980A“. This is a combination of the parties to the agreement (FRA-TON), the activity described in the treaty, which is here”Delimitation of Economic Zone (DEZ)", with the year of signature (1980), followed by the type (A = Agreement).</p>
<p>A bilateral treaty that is any other type than an agreement (e.g. protocol, amendments) will have the treatyID under this format: "RUS-USA[FKC]_1967E:FKC_1965A“. It is composed of the parties (RUS-USA), the activity abbreviation from treaty title”Fishing for King Crab (FKC)“, the year of signature of the amendment (1967), the type (E) which refers to Amendment. The linkage portion links the agreement to the treatyID its”mother" treaty, but without repeating the parties ([FKC]_1965A).</p>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th><strong>Type</strong></th>
<th><strong>Pasting</strong></th>
<th><strong>Pasting</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Multilateral</td>
<td>HSPDF_2005A</td>
<td>acronym_uID(type)</td>
</tr>
<tr class="even">
<td>Multilateral + Protocol</td>
<td>SFDP_2007E2:H08F_1992A</td>
<td>acronym, uID,type(number):linkage</td>
</tr>
</tbody>
</table>
<p>A multilateral treaty that is an agreement will have the following treatyID: “HSPDF_2005A”. The treatyID indicates the acronym (HSPDF), the signature year of the agreement (2005) and the type (A).</p>
<p>A multilateral treaty that is not an agreement will have this treatyID format: “SFDP_1992E2:H08F_2007”. This represents the acronym (SFDP), the signature year of the amendment (2007), the type (E = Amendment), the number of amendment (2) and the linkage number (H08F_2007) of the “mother” treaty.</p>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th><strong>Type</strong></th>
<th><strong>Pasting</strong></th>
<th><strong>Pasting</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Known treaties</td>
<td>UNCLOS1982A</td>
<td>abbreviation, uID, type</td>
</tr>
<tr class="even">
<td>Amendment of known treaties</td>
<td>J09H_1990E2:MARPOL1973A</td>
<td>acronym_uID,type(number):linkage</td>
</tr>
</tbody>
</table>
<p>Famous multilateral treaties have a simplified treatyID with a known abbreviation. For example, the United Nations Convention On The Law Of The Sea will have the following treatyID: “UNCLOC1982A”. This is the known abbreviation (UNCLOS) and the signature year (1982) with the type (A).</p>
<p>Protocols or amendments of the known treaties will have this treatyID format: “J09H_1990E2:MARPOL1973A”. It indicates the acronym (J09H), the signature year of this specific amendment (1990), the type of treaty (E), its number (2) and the treatyID of the “mother” treaty (MARPOL197A).</p>
</div>
<div class="section level2">
<h2 id="how-code_agreements-work">How <code>code_agreements()</code> work<a class="anchor" aria-label="anchor" href="#how-code_agreements-work"></a>
</h2>
<p>The function extracts important information from treaty titles and dates at each step of the way to make sure duplicates are actual duplicates.</p>
<div class="section level3">
<h3 id="parties">Parties<a class="anchor" aria-label="anchor" href="#parties"></a>
</h3>
<p>The first element extracted from the title are the parties to a treaty. The function <code><a href="../reference/code_parties.html">code_parties()</a></code>returns the 3 digit ISO codes for states when there are two parties identified (i.e. bilateral treaty). The three letters abbreviation in brackets pasted next to the parties represent the activity of the title. The activity is generated with <code><a href="../reference/code_activity.html">code_activity()</a></code>, which uses core words at the end of trety titles to generate 3 letter acronyms for activity. Parties and activity are only returned for bilateral treaties.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">manypkgs</span><span class="fu">::</span><span class="fu"><a href="../reference/code_parties.html">code_parties</a></span><span class="op">(</span><span class="va">agreements</span><span class="op">$</span><span class="va">titles</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="acronyms">Acronyms<a class="anchor" aria-label="anchor" href="#acronyms"></a>
</h3>
<p>Multilateral treaties start with the acronyms generated by the <code><a href="../reference/code_acronym.html">code_acronym()</a></code> function. <code><a href="../reference/code_acronym.html">code_acronym()</a></code> extracts letters from the title once specific words, numbers and special characters are deleted from the title. if the title exceed a certain length (6 letters), some of the acronyms contain the numbers of the ltters ommited when generating the acronym.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">manypkgs</span><span class="fu">::</span><span class="fu"><a href="../reference/code_acronym.html">code_acronym</a></span><span class="op">(</span><span class="va">agreements</span><span class="op">$</span><span class="va">titles</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="date">Date<a class="anchor" aria-label="anchor" href="#date"></a>
</h3>
<p>The year of the treaty’s signature is extracted with <code>code_dates</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">manypkgs</span><span class="fu">::</span><span class="fu"><a href="../reference/code_dates.html">code_dates</a></span><span class="op">(</span><span class="va">agreements</span><span class="op">$</span><span class="va">dates</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="type">Type<a class="anchor" aria-label="anchor" href="#type"></a>
</h3>
<p><code><a href="../reference/code_type.html">code_type()</a></code> detects the type of the treaty and assigns a letter for each agreement type.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">manypkgs</span><span class="fu">::</span><span class="fu"><a href="../reference/code_type.html">code_type</a></span><span class="op">(</span><span class="va">agreements</span><span class="op">$</span><span class="va">titles</span><span class="op">)</span></code></pre></div>
<ul>
<li>Agreements = <strong>A</strong>
</li>
<li>Amendments = <strong>E</strong>
</li>
<li>Protocol = <strong>P</strong>
</li>
<li>Notes = <strong>N</strong>
</li>
<li>Resolutions = <strong>R</strong>
</li>
<li>Strategy = <strong>S</strong>
</li>
</ul>
<p>To see which key words are used to identify the treaty type, please run <code><a href="../reference/code_type.html">code_type()</a></code>.</p>
<p>For amendments or protocol, their ordering numbers, if present, are also extracted in <code><a href="../reference/code_type.html">code_type()</a></code></p>
</div>
<div class="section level3">
<h3 id="known-agreements">Known Agreements<a class="anchor" aria-label="anchor" href="#known-agreements"></a>
</h3>
<p>Are these a famous agreements for which abbreviations are known? Some treaties already have well-known abbreviations.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">manypkgs</span><span class="fu">::</span><span class="fu"><a href="../reference/code_known_agreements.html">code_known_agreements</a></span><span class="op">(</span><span class="va">agreements</span><span class="op">$</span><span class="va">titles</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th><strong>Know Agreements</strong></th>
<th><strong>Abbreviation</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td>“United Nations Convention On The Law Of The Sea”</td>
<td>UNCLOS1982</td>
</tr>
<tr class="even">
<td>“Convention On Biological Diversity”</td>
<td>CBD1992</td>
</tr>
<tr class="odd">
<td>“Convention On The Conservation Of Antarctic Marine Living Resources”</td>
<td>CCAMLR1980</td>
</tr>
<tr class="even">
<td>“Convention On International Trade In Endangered Species Of Wild Fauna And Flora”</td>
<td>CITES1973</td>
</tr>
<tr class="odd">
<td>“International Convention On Civil Liability For Oil Pollution Damage”</td>
<td>CLC1969</td>
</tr>
<tr class="even">
<td>“International Convention For The Prevention Of Pollution From Ships”</td>
<td>MARPOL 1973</td>
</tr>
<tr class="odd">
<td>“Constitutional Agreement Of The Latin American Organization For Fisheries Development”</td>
<td>OLDEPESCA1982</td>
</tr>
<tr class="even">
<td>“Paris Agreement Under The United Nations Framework Convention On Climate Change”</td>
<td>PARIS2015</td>
</tr>
<tr class="odd">
<td>“Convention On Wetlands Of International Importance Especially As Waterfowl Habitat”</td>
<td>RAMSA1971</td>
</tr>
<tr class="even">
<td>“United Nations Framework Convention On Climate Change”</td>
<td>UNFCCC1992</td>
</tr>
</tbody>
</table>
<p>For the complete list of known agreements coded, please run <code><a href="../reference/code_known_agreements.html">code_known_agreements()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="linkage">Linkage<a class="anchor" aria-label="anchor" href="#linkage"></a>
</h3>
<p>Detects the family a treaty might belong to. Treaties from the same family can be detected by removing predictable words that are added to treaty titles (e.g. amendment, protocol, meeting) and identifying duplicates based on the core words used to refer to a main agreement.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">manypkgs</span><span class="fu">::</span><span class="fu"><a href="../reference/code_linkage.html">code_linkage</a></span><span class="op">(</span><span class="va">agreements</span><span class="op">$</span><span class="va">titles</span>, <span class="va">agreements</span><span class="op">$</span><span class="va">dates</span><span class="op">)</span></code></pre></div>
<p>Once added together, the information extracted from treaty title and date forms a treatyID which is more authoritative, comprehensible, succinct and intelligible than other conventions.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://jameshollway.com/" class="external-link">James Hollway</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Part of the <a href="https://panarchic.ch/" class="external-link">PANARCHIC project</a>.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
